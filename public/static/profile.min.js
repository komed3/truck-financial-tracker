const _=e=>document.getElementById(e),openProfile=e=>location.href="?profile="+e;async function deleteProfile(e){confirm("Do you really want to delete this profile? This action cannot be undone.")&&(await fetch("/api/delete",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({profileId:e})}),await loadProfiles())}async function loadProfiles(){const e=_("profilesList");try{const o=await fetch("/api/index");if(!o.ok)throw new Error("Failed to fetch profiles");const t=await o.json();if(!t||0===t.length)return void(e.innerHTML='<div class="empty">No profiles found. Create a new one below.</div>');e.innerHTML=t.map((e=>`<div class="profile-card"><h3>${e.gameInfo.playerName} — ${e.gameInfo.game.toUpperCase()}</h3><p class="info">${e.gameInfo.companyName} • ${e.gameInfo.startingLocation} • ${e.gameInfo.currency}</p><p class="date">Created at ${new Intl.DateTimeFormat("en-US").format(new Date(e.gameInfo.createdAt))}</p><div class="profile-actions"><button class="btn primary" onclick="openProfile('${e.profileId}')">Open Profile</button><button class="btn danger" onclick="deleteProfile('${e.profileId}')">Delete</button></div></div>`)).join("")}catch(o){e.innerHTML=`<div class="empty">Error loading profiles: ${o.message}</div>`}}async function createProfile(e){try{const o=await fetch("/api/create",{method:"post",body:JSON.stringify(Object.fromEntries(new FormData(e))),headers:{"Content-Type":"application/json"}});if(!o.ok)return;e.reset();const{profileId:t}=await o.json();t?openProfile(t):await loadProfiles()}catch(e){alert("Error occured: "+e.message)}}document.addEventListener("DOMContentLoaded",(function(){loadProfiles(),_("createProfileForm").addEventListener("submit",(async e=>{e.preventDefault(),await createProfile(e.target)}))}));