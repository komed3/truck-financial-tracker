const $=t=>document.querySelector(t),$$=t=>document.querySelectorAll(t),_=t=>document.getElementById(t),weekDays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];class TruckFinancialTracker{constructor(){this.profileId=new URLSearchParams(window.location.search).get("profile"),this.data=null,this.currency="EUR",this.notifTimeout=null,this.currentTab=null,this.charts={},this.maxChartPoints=-250,Chart.defaults.responsive=!0,Chart.defaults.maintainAspectRatio=!1,Chart.defaults.offset=!1,Chart.defaults.layout.padding=0,Chart.defaults.font.family="Rubik, sans-serif",Chart.defaults.font.size=14,Chart.defaults.font.weight=400,Chart.defaults.color="#000",Chart.defaults.transitions={active:{animation:{duration:0}}},Chart.defaults.animations={x:{duration:0},y:{duration:150,easing:"easeOutBack"}},Chart.defaults.plugins.tooltip.padding={top:10,left:12,right:16,bottom:10},Chart.defaults.plugins.tooltip.animation={duration:150,easing:"easeOutBack"},Chart.defaults.plugins.tooltip.titleColor="#000",Chart.defaults.plugins.tooltip.bodyColor="#000",Chart.defaults.plugins.tooltip.backgroundColor="#fff",Chart.defaults.plugins.tooltip.borderColor="#d5d6d7",Chart.defaults.plugins.tooltip.borderWidth=1,Chart.defaults.plugins.tooltip.cornerRadius=5,Chart.defaults.plugins.tooltip.boxPadding=4,this.setupEventListeners(),this.init()}async#t(t,a={}){try{const e=await fetch("/api/"+t,{method:"post",body:JSON.stringify({profileId:this.profileId,...a}),headers:{"Content-Type":"application/json"}});return await e.json()}catch(t){return this.showError("Failed to fetch data. Please make sure the game is initialized."),null}}async#a(t,a){this.freeze(),this.closeModal(),this.data=await this.#t(t,Object.fromEntries(new FormData(a)))||this.data,this.refreshTab(),this.unfreeze(),a.reset()}setupEventListeners(){document.addEventListener("click",(t=>{t.target.closest("#openTabMenu")?_("tabMenu").classList.toggle("active"):_("tabMenu").classList.remove("active")})),document.addEventListener("click",(t=>{t.target.classList.contains("modal")&&this.closeModal()})),$$(".tab-btn").forEach((t=>t.addEventListener("click",(t=>{this.switchTab(t.target.dataset.tab)})))),$$("form").forEach((t=>t.addEventListener("submit",(t=>{t.preventDefault(),this[t.target.id+"Handler"](t.target)})))),window.addEventListener("resize",(()=>this.refreshTab()))}async init(){await this.loadData(),this.switchTab("dashboard")}async loadData(){this.data=await this.#t("profile"),this.currency=this.data?.gameInfo.currency,this.updateHeader()}updateHeader(){if(!this.data)return;const{game:t,playerName:a,companyName:e,startingLocation:r,currency:s}=this.data?.gameInfo??{};_("profileInfo").textContent=`${a} — ${t.toUpperCase()}`,_("companyInfo").textContent=`${e} • ${r} • ${s}`}assetById(t,a){return(this.data?.assets[t]??[]).filter((t=>t.id===a))[0]??null}locationOptions(t){t.innerHTML=(this.data?.assets?.garages??[]).map((t=>`<option value="${t.location}">${t.location}</option>`)).join("")}freeze(){_("loading").classList.add("active")}unfreeze(){_("loading").classList.remove("active")}formatDay(t=null,a=!0){const{currentDay:e=0,gameInfo:{startingWeekday:r=1}}=this.data,s=(t=null===t?e:Number(t))%10==1&&t%100!=11?"st":t%10==2&&t%100!=12?"nd":t%10==3&&t%100!=13?"rd":"th";return a?`${t}${s}`:`${t}${s}, ${weekDays[(r+t-1)%7]}`}formatCurrency(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:this.currency,currencyDisplay:"symbol",notation:"compact",minimumFractionDigits:1,maximumFractionDigits:2}).format(t)}renderTable(t,a){return`<table><thead><tr>${t.map((t=>`<th>${t}</th>`)).join("")}</tr></thead><tbody>${a.reverse().map((t=>`<tr>${t.map((t=>`<td class="${t.class}">${t.value}</td>`)).join("")}</tr>`)).join("")}</tbody></table>`}createRecordsTable(t){const a=t.map(((t,a)=>[{value:this.formatDay(t.day??a)},{class:"currency",value:this.formatCurrency(t.totalCap)},{class:"currency",value:this.formatCurrency(t.report.totalAssets)},{class:"currency",value:this.formatCurrency(t.report.totalDebt)},{class:"currency",value:this.formatCurrency(t.report.netAssets)},{class:"currency",value:this.formatCurrency(t.report.cashOnHand)},{class:"currency",value:this.formatCurrency(t.report.valutation)},{class:"currency "+(t.profit.today<0?"negative":"positive"),value:this.formatCurrency(Math.abs(t.profit.today))},{value:t.report.cashRatio.toFixed(2)}]));return this.renderTable(["Day","Total Cap","Assets","Total Debt","Net Assets","Cash on Hand","Est. Valutation","Profit/Loss","Cash Ratio"],a)}renderCapitalizationChart(t){this.charts.capitalization&&this.charts.capitalization.destroy();const a={borderWidth:3,hoverBorderWidth:3,pointRadius:0,pointHoverRadius:0},e=[],r=[],s=[],i=[],o=[];(this.data?.dailyRecords??[]).slice(this.maxChartPoints).map(((t,a)=>{e.push(t.day??a),r.push(t.assets.cashBalance),s.push(t.assets.garageValue),i.push(t.assets.truckValue),o.push(t.assets.trailerValue)})),this.charts.capitalization=new Chart(t,{type:"area",data:{labels:e,datasets:[{label:"Cash",data:r,borderColor:"#27ae60",backgroundColor:"#bdf0d2",...a},{label:"Garages",data:s,borderColor:"#3498db",backgroundColor:"#b9dcf3",...a},{label:"Trucks",data:i,borderColor:"#f39c12",backgroundColor:"#fbdaa7",...a},{label:"Trailers",data:o,borderColor:"#9b59b6",backgroundColor:"#ddc6e6",...a}]},options:{interaction:{mode:"index",intersect:!1},scales:{x:{stacked:!0,ticks:{maxTicksLimit:10,callback:t=>this.formatDay(t)},grid:{display:!1},border:{color:"#e0e0e0"}},y:{display:!0,position:"left",type:"linear",stacked:!0,ticks:{maxTicksLimit:6,callback:t=>this.formatCurrency(t)},grid:{color:"#e0e0e0"},border:{dash:[5,5],color:"#e0e0e0"}}},plugins:{legend:{position:"bottom"},tooltip:{callbacks:{title:t=>this.formatDay(t[0].label,!1),label:t=>`${t.dataset.label}: ${this.formatCurrency(t.raw)}`}}}}})}renderDistributionChart(t){this.charts.distribution&&this.charts.distribution.destroy();const{totalCap:a,assets:e}=(this.data?.dailyRecords??[]).at(-1);a&&e&&(this.charts.distribution=new Chart(t,{type:"doughnut",data:{labels:["Cash","Garages","Trucks","Trailers"],datasets:[{data:[e.cashBalance,e.garageValue,e.truckValue,e.trailerValue],borderWidth:6,hoverBorderWidth:6,borderColor:"#fff",hoverBorderColor:"#fff",backgroundColor:["#27ae60","#3498db","#f39c12","#9b59b6"],hoverBackgroundColor:["#27ae60","#3498db","#f39c12","#9b59b6"]}]},options:{radius:"80%",plugins:{legend:{position:"bottom",labels:{boxWidth:18,boxHeight:18}},tooltip:{callbacks:{label:t=>`${this.formatCurrency(t.raw)} (${(t.raw/a*100).toFixed()}%)`}}}}}))}renderDailyProfitChart(t){this.charts.dailyProfit&&this.charts.dailyProfit.destroy();const a=[],e=[],r=[];(this.data?.dailyRecords??[]).slice(this.maxChartPoints).map(((t,s)=>{a.push(t.day??s),e.push(Math.max(0,t.profit.today)),r.push(Math.min(0,t.profit.today))})),this.charts.dailyProfit=new Chart(t,{type:"bar",data:{labels:a,datasets:[{label:"Profit",data:e,backgroundColor:"#27ae60",hoverBackgroundColor:"#27ae60",borderWidth:0,hoverBorderWidth:0},{label:"Loss",data:r,backgroundColor:"#e74c3c",hoverBackgroundColor:"#e74c3c",borderWidth:0,hoverBorderWidth:0}]},options:{interaction:{mode:"index",intersect:!1},scales:{x:{stacked:!0,ticks:{maxTicksLimit:10,callback:t=>this.formatDay(t)},grid:{display:!1},border:{color:"#e0e0e0"}},y:{display:!0,position:"left",type:"linear",stacked:!0,ticks:{maxTicksLimit:6,callback:t=>this.formatCurrency(t)},grid:{color:"#e0e0e0"},border:{dash:[5,5],color:"#e0e0e0"}}},plugins:{legend:!1,tooltip:{displayColors:!1,bodyFont:{size:22},callbacks:{title:t=>this.formatDay(t[0].label,!1),label:t=>0===t.raw?null:this.formatCurrency(t.raw)}}}}})}renderNetAssetsChart(t){this.charts.netAssets&&this.charts.netAssets.destroy();const a=[],e=[];(this.data?.dailyRecords??[]).slice(this.maxChartPoints).map(((t,r)=>{a.push(t.day??r),e.push(t.report.netAssets)})),this.charts.netAssets=new Chart(t,{type:"area",data:{labels:a,datasets:[{label:"Net Assets",data:e,color:"#3498db",fillOpacity:.36,borderWidth:3,hoverBorderWidth:3,pointRadius:0,pointHoverRadius:0,tension:.05}]},options:{interaction:{mode:"index",intersect:!1},scales:{x:{ticks:{maxTicksLimit:10,callback:t=>this.formatDay(t)},grid:{display:!1},border:{color:"#e0e0e0"}},y:{position:"left",type:"linear",ticks:{maxTicksLimit:6,callback:t=>this.formatCurrency(t)},grid:{color:"#e0e0e0"},border:{dash:[5,5],color:"#e0e0e0"}}},plugins:{legend:!1,tooltip:{displayColors:!1,bodyFont:{size:22},callbacks:{title:t=>this.formatDay(t[0].label,!1),label:t=>this.formatCurrency(t.raw)}}}}})}renderTotalDebtChart(t){this.charts.totalDebt&&this.charts.totalDebt.destroy();const a=[],e=[];(this.data?.dailyRecords??[]).slice(this.maxChartPoints).map(((t,r)=>{a.push(t.day??r),e.push(t.report.totalDebt)})),this.charts.totalDebt=new Chart(t,{type:"area",data:{labels:a,datasets:[{label:"Total Debt",data:e,color:"#e74c3c",fillOpacity:.36,borderWidth:3,hoverBorderWidth:3,pointRadius:0,pointHoverRadius:0,tension:.05}]},options:{interaction:{mode:"index",intersect:!1},scales:{x:{ticks:{maxTicksLimit:10,callback:t=>this.formatDay(t)},grid:{display:!1},border:{color:"#e0e0e0"}},y:{position:"left",type:"linear",ticks:{maxTicksLimit:6,callback:t=>this.formatCurrency(t)},grid:{color:"#e0e0e0"},border:{dash:[5,5],color:"#e0e0e0"}}},plugins:{legend:!1,tooltip:{displayColors:!1,bodyFont:{size:22},callbacks:{title:t=>this.formatDay(t[0].label,!1),label:t=>this.formatCurrency(t.raw)}}}}})}renderValutationChart(t){this.charts.valutation&&this.charts.valutation.destroy();const a=[],e=[];(this.data?.dailyRecords??[]).slice(this.maxChartPoints).map(((t,r)=>{a.push(t.day??r),e.push(t.report.valutation)})),this.charts.valutation=new Chart(t,{type:"area",data:{labels:a,datasets:[{label:"Valutation",data:e,color:"#27ae60",negativeColor:"#e74c3c",fillOpacity:.36,borderWidth:3,hoverBorderWidth:3,pointRadius:0,pointHoverRadius:0}]},options:{clip:!1,interaction:{mode:"index",intersect:!1},scales:{x:{ticks:{maxTicksLimit:10,callback:t=>this.formatDay(t)},grid:{display:!1},border:{color:"#e0e0e0"}},y:{position:"left",type:"linear",ticks:{maxTicksLimit:6,callback:t=>this.formatCurrency(t)},grid:{color:"#e0e0e0"},border:{dash:[5,5],color:"#e0e0e0"}}},plugins:{legend:!1,tooltip:{displayColors:!1,bodyFont:{size:22},callbacks:{title:t=>this.formatDay(t[0].label,!1),label:t=>this.formatCurrency(t.raw)}}}}})}renderAvgProfitChart(t){this.charts.avgProfit&&this.charts.avgProfit.destroy();const a={borderWidth:3,hoverBorderWidth:3,pointRadius:0,pointHoverRadius:0,tension:.05},e=[],r=[],s=[],i=[];(this.data?.dailyRecords??[]).slice(this.maxChartPoints).map(((t,a)=>{e.push(t.day??a),r.push(t.profit.avg7),s.push(t.profit.avg30),i.push(t.profit.avg90)})),this.charts.avgProfit=new Chart(t,{type:"line",data:{labels:e,datasets:[{label:"7d Avg.",data:r,borderColor:"#27ae60",hoverBorderColor:"#27ae60",...a},{label:"30d Avg.",data:s,borderColor:"#f39c12",hoverBorderColor:"#f39c12",...a},{label:"90d Avg.",data:i,borderColor:"#9b59b6",hoverBorderColor:"#9b59b6",...a}]},options:{interaction:{mode:"index",intersect:!1},scales:{x:{ticks:{maxTicksLimit:10,callback:t=>this.formatDay(t)},grid:{display:!1},border:{color:"#e0e0e0"}},y:{display:!0,position:"left",type:"linear",ticks:{maxTicksLimit:6,callback:t=>this.formatCurrency(t)},grid:{color:"#e0e0e0"},border:{dash:[5,5],color:"#e0e0e0"}}},plugins:{legend:{position:"bottom"},tooltip:{callbacks:{title:t=>this.formatDay(t[0].label,!1),label:t=>`${t.dataset.label}: ${this.formatCurrency(t.raw)}`}}}}})}renderCashRatioChart(t){this.charts.cashRatio&&this.charts.cashRatio.destroy();const a=[],e=[];(this.data?.dailyRecords??[]).slice(this.maxChartPoints).map(((t,r)=>{a.push(t.day??r),e.push(t.report.cashRatio)})),this.charts.cashRatio=new Chart(t,{type:"area",data:{labels:a,datasets:[{label:"Cash Ratio",data:e,color:"#232323",fillOpacity:.25,borderWidth:3,hoverBorderWidth:3,pointRadius:0,pointHoverRadius:0}]},options:{clip:!1,interaction:{mode:"index",intersect:!1},scales:{x:{ticks:{maxTicksLimit:10,callback:t=>this.formatDay(t)},grid:{display:!1},border:{color:"#e0e0e0"}},y:{position:"left",type:"linear",min:0,max:1,ticks:{maxTicksLimit:6,callback:t=>t.toFixed(2)},grid:{color:"#e0e0e0"},border:{dash:[5,5],color:"#e0e0e0"}}},plugins:{legend:!1,tooltip:{displayColors:!1,bodyFont:{size:22},callbacks:{title:t=>this.formatDay(t[0].label,!1),label:t=>t.raw.toFixed(2)}}}}})}switchTab(t,a=!1){(a||t!==this.currentTab)&&(this.currentTab=t,$$(".tab-btn").forEach((t=>t.classList.remove("active"))),$(`[data-tab="${t}"]`).classList.add("active"),$$(".tab-content").forEach((t=>t.classList.remove("active"))),_(t).classList.add("active"),this.loadTabContent(t))}refreshTab(){this.switchTab(this.currentTab,!0)}async loadTabContent(t){switch(t){case"dashboard":this.renderDashboard();break;case"daily":this.renderDailyRecords();break;case"garages":this.renderGarages();break;case"trucks":this.renderTrucks();break;case"trailers":this.renderTrailers();break;case"drivers":this.renderDrivers();break;case"loans":this.renderLoans();break;case"reports":this.renderReports();break}}openModal(t,a=!0){_(t+"Modal").classList.add("active"),a&&_(t+"Form").reset();const e=$("#"+t+'Form select[name="location"]');e&&this.locationOptions(e)}closeModal(){$$(".modal").forEach((t=>t.classList.remove("active")))}switchProfile(){location.href="/"}showNotification(t,a="success"){_("notification").textContent=t,_("notification").classList.remove("success","error"),_("notification").classList.add(a),_("notification").style.display="block",clearTimeout(this.notifTimeout),this.notifTimeout=setTimeout((()=>_("notification").style.removeProperty("display")),2e3)}showError(t){this.showNotification(t,"error")}renderDashboard(){this.renderOverviewCards(),this.renderRecentRecords(),this.renderCapitalizationChart(_("capitalizationChart")),this.renderDistributionChart(_("distributionChart"))}renderOverviewCards(){if(_("currentDay").textContent=this.formatDay(),this.data?.dailyRecords?.length){const{totalCap:t,report:{netAssets:a,totalDebt:e,cashOnHand:r,valutation:s},profit:{avg90:i},stats:{garages:o,parkingLots:n,trucks:l,trailers:d,drivers:c}}=this.data.dailyRecords.at(-1);_("totalCap").textContent=this.formatCurrency(Math.abs(t)),_("totalDebt").textContent=this.formatCurrency(Math.abs(e)),_("netAssets").textContent=this.formatCurrency(Math.abs(a)),_("cashOnHand").textContent=this.formatCurrency(Math.abs(r)),_("valutation").textContent=this.formatCurrency(Math.abs(s)),_("avgProfit").textContent=this.formatCurrency(Math.abs(i)),_("totalCap").classList.toggle("negative",t<0),_("totalDebt").classList.toggle("negative",e>0),_("netAssets").classList.toggle("negative",a<0),_("cashOnHand").classList.toggle("negative",r<0),_("valutation").classList.toggle("negative",s<0),_("avgProfit").classList.toggle("negative",i<0),_("garageCount").textContent=o,_("parkingLots").textContent=n,_("truckCount").textContent=l,_("trailerCount").textContent=d,_("driverCount").textContent=c}else _("totalCap").textContent="N/A",_("totalDebt").textContent="N/A",_("netAssets").textContent="N/A",_("cashOnHand").textContent="N/A",_("valutation").textContent="N/A",_("avgProfit").textContent="N/A",_("totalCap").classList.remove("negative"),_("totalDebt").classList.remove("negative"),_("netAssets").classList.remove("negative"),_("cashOnHand").classList.remove("negative"),_("valutation").classList.remove("negative"),_("avgProfit").classList.remove("negative"),_("garageCount").textContent="N/A",_("parkingLots").textContent="N/A",_("truckCount").textContent="N/A",_("trailerCount").textContent="N/A",_("driverCount").textContent="N/A"}renderRecentRecords(){const t=(this.data?.dailyRecords??[]).slice(-7),a=_("recentRecordsTable");if(0===t.length)return void(a.innerHTML='<div class="empty">No daily records yet. Add your first record to get started!</div>');const e=this.createRecordsTable(t);a.innerHTML=e}renderDailyRecords(){const t=_("dailyRecordsTable");if(0===this.data?.dailyRecords?.length)return void(t.innerHTML='<div class="empty">No daily records yet. Add your first record to get started!</div>');const a=this.createRecordsTable(this.data.dailyRecords.slice());t.innerHTML=a}async dailyFormHandler(t){await this.#a("dailyRecord",t)}renderGarages(){const t=_("garagesTable");if(0===this.data?.assets?.garages?.length)return void(t.innerHTML='<div class="empty">No garages yet. Add your first garage to get started!</div>');const a=this.data.assets.garages.map((t=>[{value:t.location},{value:this.formatDay(t.day)},{class:"label",value:`<span>${t.size}</span>`},{class:"currency",value:this.formatCurrency(t.value)},{class:"actions",value:`<button class="btn" onclick="app.garageDetails('${t.id}')">Details</button><button class="btn" onclick="app.editGarage('${t.id}')">Edit</button><button class="btn danger" onclick="app.deleteGarage('${t.id}')">Delete</button>`}]));t.innerHTML=this.renderTable(["Location","Day","Size","Value","Actions"],a)}async garageFormHandler(t){await this.#a("garage/edit",t)}editGarage(t){const a=this.assetById("garages",t);a&&(this.openModal("garage"),_("garageId").value=t,_("garageLocation").value=a.location,_("garageValue").value=a.value,_("garageSize").value=a.size)}async deleteGarage(t){confirm("Do you want to delete this garage?")&&(this.data=await this.#t("garage/delete",{garageId:t})||this.data,this.refreshTab())}garageDetails(t){const a=this.assetById("garages",t);if(!a)return;const e=(this.data?.assets?.trucks??[]).filter((t=>t.location===a.location)),r=(this.data?.assets?.trailers??[]).filter((t=>t.location===a.location)),s=(this.data?.assets?.drivers??[]).filter((t=>t.location===a.location)),i={small:1,medium:3,large:5}[a.size]||0,o=e.length+r.length,n=e.reduce(((t,a)=>t+a.value),0)+r.reduce(((t,a)=>t+a.value),0);this.openModal("garageDetails",!1),_("garageDetailsLocation").textContent=a.location,_("garageDetailsParkingLots").textContent=o+" / "+i,_("garageDetailsValue").textContent=this.formatCurrency(n),$("#garageDetailsTable tbody").innerHTML=e.map((t=>`<tr><td>${t.brand}, ${t.model}</td><td>${this.formatDay(t.day)}</td><td>${this.formatCurrency(t.value)}</td></tr>`)).join("")+r.map((t=>`<tr><td>${t.type}, ${t.capacity}</td><td>${this.formatDay(t.day)}</td><td>${this.formatCurrency(t.value)}</td></tr>`)).join("")+s.map((t=>`<tr><td>${t.name}</td><td>${this.formatDay(t.day)}</td><td>—</td></tr>`)).join("")}renderTrucks(){const t=_("trucksTable");if(0===this.data?.assets?.trucks?.length)return void(t.innerHTML='<div class="empty">No trucks yet. Add your first truck to get started!</div>');const a=this.data.assets.trucks.map((t=>[{value:t.brand},{value:t.model},{value:this.formatDay(t.day)},{class:"label",value:`<span>${t.condition}</span>`},{value:t.location},{class:"currency",value:this.formatCurrency(t.value)},{class:"actions",value:`<button class="btn" onclick="app.editTruck('${t.id}')">Edit</button><button class="btn danger" onclick="app.deleteTruck('${t.id}')">Delete</button>`}]));t.innerHTML=this.renderTable(["Brand","Model","Day","Condition","Location","Value","Actions"],a)}async truckFormHandler(t){await this.#a("truck/edit",t)}editTruck(t){const a=this.assetById("trucks",t);a&&(this.openModal("truck"),_("truckId").value=t,_("truckBrand").value=a.brand,_("truckModel").value=a.model,_("truckValue").value=a.value,_("truckCondition").value=a.condition,_("truckLocation").value=a.location)}async deleteTruck(t){confirm("Do you want to delete this truck?")&&(this.data=await this.#t("truck/delete",{truckId:t})||this.data,this.refreshTab())}renderTrailers(){const t=_("trailersTable");if(0===this.data?.assets?.trailers?.length)return void(t.innerHTML='<div class="empty">No trailers yet. Add your first trailer to get started!</div>');const a=this.data.assets.trailers.map((t=>[{value:t.type},{value:t.capacity},{value:this.formatDay(t.day)},{class:"label",value:`<span>${t.condition}</span>`},{value:t.location},{class:"currency",value:this.formatCurrency(t.value)},{class:"actions",value:`<button class="btn" onclick="app.editTrailer('${t.id}')">Edit</button><button class="btn danger" onclick="app.deleteTrailer('${t.id}')">Delete</button>`}]));t.innerHTML=this.renderTable(["Type","Capacity","Day","Condition","Location","Value","Actions"],a)}async trailerFormHandler(t){await this.#a("trailer/edit",t)}editTrailer(t){const a=this.assetById("trailers",t);a&&(this.openModal("trailer"),_("trailerId").value=t,_("trailerType").value=a.type,_("trailerCapacity").value=a.capacity,_("trailerValue").value=a.value,_("trailerCondition").value=a.condition,_("trailerLocation").value=a.location)}async deleteTrailer(t){confirm("Do you want to delete this trailer?")&&(this.data=await this.#t("trailer/delete",{trailerId:t})||this.data,this.refreshTab())}renderDrivers(){const t=_("driversTable");if(0===this.data?.assets?.drivers?.length)return void(t.innerHTML='<div class="empty">No drivers yet. Add your first driver to get started!</div>');const a=this.data.assets.drivers.map((t=>[{value:t.name},{value:this.formatDay(t.day)},{value:t.location},{class:"label",value:`<span>${t.status}</span>`},{class:"label",value:`<span>${t.skillLevel}</span>`},{class:"actions",value:`<button class="btn" onclick="app.editDriver('${t.id}')">Edit</button><button class="btn danger" onclick="app.deleteDriver('${t.id}')">Delete</button>`}]));t.innerHTML=this.renderTable(["Name","Hire Day","Location","Status","Skill Level","Actions"],a)}async driverFormHandler(t){await this.#a("driver/edit",t)}editDriver(t){const a=this.assetById("drivers",t);a&&(this.openModal("driver"),_("driverId").value=t,_("driverName").value=a.name,_("driverLocation").value=a.location,_("driverStatus").value=a.status,_("driverSkill").value=a.skillLevel)}async deleteDriver(t){confirm("Do you want to fire this driver?")&&(this.data=await this.#t("driver/delete",{driverId:t})||this.data,this.refreshTab())}renderLoans(){const t=_("loansTable");if(0===this.data?.assets?.loans?.length)return void(t.innerHTML='<div class="empty">No loans yet. Add your first loan to get started!</div>');const a=this.data.assets.loans.map((t=>[{class:"currency",value:this.formatCurrency(t.amount)},{value:this.formatDay(t.day)},{value:t.remaining>0?Math.max(0,this.data.currentDay-t.day-1)+" / "+t.term:"—"},{value:`${t.interestRate.toFixed(1)}%`},{class:"currency",value:this.formatCurrency(t.dailyInstallment)},{class:"currency",value:this.formatCurrency(t.remaining)},{class:"actions",value:`<button class="btn" onclick="app.editLoan('${t.id}')">Edit</button><button class="btn danger" onclick="app.clearingLoan('${t.id}')">Clearing</button>`}]));t.innerHTML=this.renderTable(["Amount","Day","Term","Interest Rate","Installment","Remaining","Actions"],a)}async loanFormHandler(t){await this.#a("loan/edit",t)}editLoan(t){const a=this.assetById("loans",t);a&&(this.openModal("loan"),_("loanId").value=t,_("loanAmount").value=a.amount,_("loanTerm").value=a.term,_("loanInterestRate").value=a.interestRate,_("loanInstallment").value=a.dailyInstallment,_("loanRemaining").value=a.remaining)}async clearingLoan(t){confirm("When confirmed, the remaining amount will be paid off entirely.")&&(this.data=await this.#t("loan/clearing",{loanId:t})||this.data,this.refreshTab())}renderReports(){this.renderCapitalizationChart(_("capitalizationReport")),this.renderDailyProfitChart(_("dailyProfitReport")),this.renderNetAssetsChart(_("netAssetsReport")),this.renderTotalDebtChart(_("totalDebtReport")),this.renderValutationChart(_("valutationReport")),this.renderAvgProfitChart(_("avgProfitReport")),this.renderCashRatioChart(_("cashRatioReport"))}}document.addEventListener("DOMContentLoaded",(()=>{window.app=new TruckFinancialTracker}));